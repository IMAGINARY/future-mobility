{"version":3,"sources":["webpack://future-mobility/./node_modules/events/events.js","webpack://future-mobility/./src/sass/default.scss?bcb6","webpack://future-mobility/./src/js/aux/array-2d.js","webpack://future-mobility/./src/js/aux/config-helpers.js","webpack://future-mobility/./src/js/aux/flatqueue.js","webpack://future-mobility/./src/js/aux/show-fatal-error.js","webpack://future-mobility/./src/js/aux/statistics.js","webpack://future-mobility/./src/js/aux/travel-times.js","webpack://future-mobility/./src/js/city.js","webpack://future-mobility/./src/js/connection-state-view.js","webpack://future-mobility/./src/js/data-manager.js","webpack://future-mobility/./src/js/data-source.js","webpack://future-mobility/./src/js/data-sources/noise-data.js","webpack://future-mobility/./src/js/data-sources/pollution-data.js","webpack://future-mobility/./src/js/editor/city-browser.js","webpack://future-mobility/./src/js/editor/map-editor-palette.js","webpack://future-mobility/./src/js/editor/map-editor.js","webpack://future-mobility/./src/js/editor/modal-export.js","webpack://future-mobility/./src/js/editor/modal-import.js","webpack://future-mobility/./src/js/editor/modal-load.js","webpack://future-mobility/./src/js/editor/modal-save.js","webpack://future-mobility/./src/js/editor/object-store.js","webpack://future-mobility/./src/js/grid.js","webpack://future-mobility/./src/js/map-text-overlay.js","webpack://future-mobility/./src/js/map-view.js","webpack://future-mobility/./src/js/modal.js","webpack://future-mobility/./src/js/server-socket-connector.js","webpack://future-mobility/./src/js/variable-map-view.js","webpack://future-mobility/webpack/bootstrap","webpack://future-mobility/webpack/runtime/global","webpack://future-mobility/webpack/runtime/make namespace object","webpack://future-mobility/webpack/runtime/publicPath","webpack://future-mobility/./src/js/main-editor.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB;;AAEnB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,sBAAsB;AACvC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA,sCAAsC,QAAQ;AAC9C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;;AAEA;AACA,QAAQ,yBAAyB;AACjC;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,6DAA6D,aAAa;AAC1E;AACA,6DAA6D,aAAa;AAC1E;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,oCAAoC,aAAa;AACjD;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;;;;;;;;;;;;;AChfA;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B,oBAAoB,OAAO;AAC3B,uBAAuB,IAAI;AAC3B,cAAc;AACd;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA,qBAAqB,WAAW;AAChC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB;AACnB,oBAAoB;AACpB,mBAAmB;AACnB;AACA;AACA;AACA,mBAAmB,WAAW;AAC9B,qBAAqB,YAAY;AACjC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,kBAAkB;AAClB;AACA;AACA,mBAAmB,gBAAgB;AACnC,qBAAqB,mBAAmB;AACxC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe;AACf,mBAAmB;AACnB;AACA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;AACf,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA;AACA,eAAe;AACf,sBAAsB;AACtB;AACA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB;AACzB,0BAA0B;AAC1B,eAAe;AACf,eAAe;AACf;AACA;AACA;AACA,eAAe;AACf,sBAAsB;AACtB,0BAA0B;AAC1B,cAAc;AACd;AACA;AACA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,cAAc;AACjC,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,UAAU;AAC7B;AACA,qBAAqB,UAAU;AAC/B;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC5MA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,kBAAkB;;;;;;;;;;;ACVlB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;ACdA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3HA,kBAAkB,mBAAO,CAAC,8CAAa;AACvC,gBAAgB,mBAAO,CAAC,4CAAY;;AAEpC;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,qBAAqB;AAChC,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;;;;;;;;;;;AC3CA,aAAa,mBAAO,CAAC,gCAAQ;AAC7B,gBAAgB,mBAAO,CAAC,gDAAgB;;AAExC;AACA;AACA;AACA;;AAEA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;;AAEA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA,WAAW,gBAAgB;;AAE3B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACnCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACrDA,qBAAqB,mBAAO,CAAC,+CAAQ;;AAErC;AACA,8BAA8B;AAC9B,mCAAmC;AACnC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,WAAW;AACxB;AACA;AACA;AACA,gCAAgC,4BAA4B;AAC5D;AACA;AACA;;AAEA;AACA;AACA,kCAAkC,4BAA4B,2CAA2C,GAAG;AAC5G;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA,oDAAoD,WAAW;AAC/D;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;;;;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AChCA,mBAAmB,mBAAO,CAAC,+CAAgB;AAC3C,gBAAgB,mBAAO,CAAC,iDAAiB;AACzC,OAAO,gBAAgB,GAAG,mBAAO,CAAC,6DAAuB;AACzD,OAAO,8CAA8C,GAAG,mBAAO,CAAC,qDAAmB;;AAEnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;AClHA,mBAAmB,mBAAO,CAAC,+CAAgB;AAC3C,gBAAgB,mBAAO,CAAC,iDAAiB;AACzC,OAAO,gBAAgB,GAAG,mBAAO,CAAC,6DAAuB;AACzD,OAAO,4CAA4C,GAAG,mBAAO,CAAC,qDAAmB;;AAEjF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;AC1HA,aAAa,mBAAO,CAAC,iCAAS;;AAE9B;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;;;;;;;;;;;AChEA,qBAAqB,mBAAO,CAAC,+CAAQ;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,sCAAsC,GAAG;AACzC;AACA;AACA;AACA,gCAAgC,mBAAmB;AACnD,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;;AAEA;AACA;AACA,eAAe,0CAA0C;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,wCAAwC,UAAU;AAClD;AACA;AACA,gCAAgC,YAAY;AAC5C,OAAO;AACP;AACA;AACA,OAAO;;AAEP;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;;;;;;;;;;AClHA,qBAAqB,mBAAO,CAAC,+CAAQ;AACrC,aAAa,mBAAO,CAAC,iCAAS;AAC9B,gBAAgB,mBAAO,CAAC,yCAAa;AACrC,yBAAyB,mBAAO,CAAC,mEAAsB;AACvD,kBAAkB,mBAAO,CAAC,mDAAc;AACxC,kBAAkB,mBAAO,CAAC,mDAAc;AACxC,oBAAoB,mBAAO,CAAC,uDAAgB;AAC5C,oBAAoB,mBAAO,CAAC,uDAAgB;AAC5C,oBAAoB,mBAAO,CAAC,uDAAgB;AAC5C,uBAAuB,mBAAO,CAAC,yDAAqB;AACpD,oBAAoB,mBAAO,CAAC,yDAAqB;AACjD,OAAO,gBAAgB,GAAG,mBAAO,CAAC,6DAAuB;AACzD,gBAAgB,mBAAO,CAAC,iDAAiB;;AAEzC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA,SAAS;AACT;AACA;AACA;AACA;AACA,8CAA8C,yBAAyB;AACvE,gDAAgD,yBAAyB;AACzE;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;;AAEX;AACA,qCAAqC,OAAO,IAAI,OAAO;AACvD;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;;AAEA;;;;;;;;;;;ACnJA,cAAc,mBAAO,CAAC,mCAAU;;AAEhC;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;;;;;;;;;;AC3BA,cAAc,mBAAO,CAAC,mCAAU;;AAEhC;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACzCA,cAAc,mBAAO,CAAC,mCAAU;AAChC,oBAAoB,mBAAO,CAAC,uDAAgB;;AAE5C;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC3CA,cAAc,mBAAO,CAAC,mCAAU;AAChC,oBAAoB,mBAAO,CAAC,uDAAgB;;AAE5C;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC3CA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,oBAAoB;AACrC;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU,EAAE;AACZ;AACA;AACA;;AAEA;AACA;AACA,UAAU,EAAE;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACrEA,qBAAqB,mBAAO,CAAC,+CAAQ;AACrC,gBAAgB,mBAAO,CAAC,gDAAgB;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,WAAW;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wBAAwB,OAAO;AAC/B,cAAc;AACd;AACA;AACA,WAAW,uBAAuB;AAClC;AACA;;AAEA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;;AAEA;AACA;AACA;AACA,eAAe;AACf,eAAe;AACf,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;AACA,8BAA8B,kBAAkB;AAChD;AACA;AACA;AACA,8BAA8B,kBAAkB;AAChD;AACA;AACA;AACA,8BAA8B,kBAAkB;AAChD;AACA;AACA;AACA,8BAA8B,kBAAkB;AAChD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,cAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;;;;;;;;;;;AC9MA;;AAEA,gBAAgB,mBAAO,CAAC,wCAAY;AACpC,gBAAgB,mBAAO,CAAC,gDAAgB;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,2CAA2C,gBAAgB,EAAE;AAC7D;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;ACvEA;AACA,qBAAqB,mBAAO,CAAC,+CAAQ;AACrC,gBAAgB,mBAAO,CAAC,gDAAgB;AACxC,OAAO,gBAAgB,GAAG,mBAAO,CAAC,4DAAsB;AACxD,qBAAqB,mBAAO,CAAC,8EAAsC;;AAEnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,6BAA6B,aAAa;AAC1C,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,qCAAqC,4BAA4B,EAAE;;AAEnE;AACA;AACA,6BAA6B,aAAa;AAC1C;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+DAA+D,cAAc;AAC7E;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6DAA6D,SAAS;AACtE;AACA;;AAEA;AACA;AACA;AACA;AACA,wCAAwC,yBAAyB;AACjE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,yBAAyB;AAC5C;AACA;AACA;AACA,mBAAmB,0BAA0B;AAC7C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;;;;;;AC/LA;AACA;AACA,aAAa,OAAO;AACpB;AACA,aAAa,OAAO;AACpB;AACA,aAAa,OAAO;AACpB;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,aAAa;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC7DA;AACA,qBAAqB,mBAAO,CAAC,+CAAQ;;AAErC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iCAAiC,SAAS;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,gDAAgD,sBAAsB;AACtE;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,QAAQ;AACxC;AACA,8BAA8B,UAAU;AACxC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,gDAAgD,aAAa;AAC7D;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,8CAA8C,sBAAsB;AACpE;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;AC9JA;AACA,gBAAgB,mBAAO,CAAC,gDAAgB;;AAExC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;;;;;;;;;;;;;;;;;UC3CA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,EAAE;WACF;WACA;WACA,CAAC,I;;;;;WCPD;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,kC;;;;;;;;;;ACfA;AACA,aAAa,mBAAO,CAAC,gCAAQ;AAC7B,kBAAkB,mBAAO,CAAC,0DAAqB;AAC/C,wBAAwB,mBAAO,CAAC,0DAAqB;AACrD,mBAAO,CAAC,qDAAsB;AAC9B,8BAA8B,mBAAO,CAAC,sEAA2B;AACjE,4BAA4B,mBAAO,CAAC,kEAAyB;AAC7D,uBAAuB,mBAAO,CAAC,gEAAwB;AACvD,sBAAsB,mBAAO,CAAC,8EAA+B;AAC7D,kBAAkB,mBAAO,CAAC,sEAA2B;AACrD,oBAAoB,mBAAO,CAAC,gDAAgB;;AAE5C,SAAS,uBAA2B,CAAC,WAAW,oBAAoB;AACpE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,wCAAwC,uBAAuB,WAAW,EAAE,QAAQ,EAAE;AACtF;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;;AAEP,kDAAkD,qBAA6B;AAC/E;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA,uDAAuD,uBAA2B,CAAC;AACnF,sDAAsD,uBAA2B,CAAC;AAClF;AACA,GAAG","file":"editor.e8a53d62d42f24f88d90.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","// extracted by mini-css-extract-plugin\nexport {};","/**\n * This class provides helper functions to work with 2D arrays.\n * (arrays of arrays)\n */\nclass Array2D {\n  /**\n   * Create and initialize a 2D Array\n   *\n   * @param width {number} Number of columns (inner arrays size)\n   * @param height {number} Number of rows (outer array size)\n   * @param initValue {any} Initial value for inner array items\n   * @return {any[][]}\n   */\n  static create(width, height, initValue = 0) {\n    const rows = [];\n    for (let i = 0; i < height; i += 1) {\n      const row = [];\n      for (let j = 0; j < width; j += 1) {\n        row[j] = initValue;\n      }\n      rows.push(row);\n    }\n    return rows;\n  }\n\n  /**\n   * Creates a 2D array from a 1D array in cells[y * width + x] format\n   *\n   * @param width {number}\n   * @param height {number}\n   * @param cells {any[]}\n   */\n  static fromFlat(width, height, cells) {\n    const answer = Array2D.create(width, height);\n    for (let x = 0; x < width; x += 1) {\n      for (let y = 0; y < height; y += 1) {\n        answer[y][x] = cells[y * width + x];\n      }\n    }\n    return answer;\n  }\n\n  /**\n   * Returns a 1D array with the flattened contents of the 2D array\n   * @return {*[]}\n   */\n  static flatten(a) {\n    const items = [];\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        items.push(a[y][x]);\n      }\n    }\n    return items;\n  }\n\n  /**\n   * Returns true if the argument is an array of arrays and every inner\n   * array has the same length.\n   *\n   * @param a {any[][]}\n   * @return {boolean}\n   */\n  static isValid(a) {\n    return Array.isArray(a) && a.length > 0\n      && Array.isArray(a[0]) && a[0].length > 0\n      && a.every(row => row.length === a[0].length);\n  }\n\n  /**\n   * Returns the size of a 2D array as [width, height]\n   *\n   * Assumes the argument is a valid 2D Array.\n   *\n   * @param a {any[][]}\n   * @return {number[]}\n   */\n  static size(a) {\n    return [a[0].length, a.length];\n  }\n\n  /**\n   * Clones the 2D Array.\n   *\n   * Assumes the argument is a valid 2D Array. The items in the 2D\n   * array are not deep copied, only the outer and inner arrays.\n   *\n   * @param a {any[][]}\n   * @return {any[][]}\n   */\n  static clone(a) {\n    return a.map(row => Array.from(row));\n  }\n\n  /**\n   * Copies the contents of a 2D array into another.\n   *\n   * Assumes the arguments are valid 2D arrays with the same size.\n   *\n   * @param src {any[][]}\n   * @param dest {any[][]}\n   */\n  static copy(src, dest) {\n    for (let i = 0; i < src.length; i += 1) {\n      for (let j = 0; j < src[i].length; j += 1) {\n        // eslint-disable-next-line no-param-reassign\n        dest[i][j] = src[i][j];\n      }\n    }\n  }\n\n  /**\n   * Sets all cells to a fixed value\n   *\n   * @param a {any[][]}\n   * @param value {any}\n   */\n  static setAll(a, value) {\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        a[y][x] = value;\n      }\n    }\n  }\n\n  /**\n   * Returns all items as a flat array of [x, y, value] arrays.\n   *\n   * @param a {any[][]}\n   * @return {[number, number, any][]}\n   */\n  static items(a) {\n    const items = [];\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        items.push([x, y, a[y][x]]);\n      }\n    }\n    return items;\n  }\n\n  /**\n   * @callback coordinateCallback\n   * @param x {number}\n   * @param y {number}\n   * @return {any}\n   */\n  /**\n   * Fills the items in the array with the result of a callback\n   *\n   * @param a {any[][]}\n   * @param callback {coordinateCallback}\n   */\n  static fill(a, callback) {\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        a[y][x] = callback(x, y);\n      }\n    }\n  }\n\n  /**\n   * @callback reduceCallback\n   * @param accumulator {any}\n   * @param currentValue {any}\n   * @param x {number}\n   * @param y {number}\n   */\n  /**\n   *\n   * @param a {any[][]}\n   * @param callback {reduceCallback}\n   * @param initialValue {any}\n   * @return {any}\n   */\n  static reduce(a, callback, initialValue) {\n    let accumulator = initialValue;\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        accumulator = callback(accumulator, a[y][x], x, y);\n      }\n    }\n    return accumulator;\n  }\n\n  static forEach(a, callback) {\n    for (let y = 0; y < a.length; y += 1) {\n      for (let x = 0; x < a[y].length; x += 1) {\n        callback(a[y][x], x, y);\n      }\n    }\n  }\n\n  static zip(a, b, callback) {\n    const yMax = Math.min(a.length, b.length);\n    for (let y = 0; y < yMax; y += 1) {\n      const xMax = Math.min(a[y].length, b[y].length);\n      for (let x = 0; x < xMax; x += 1) {\n        callback(a[y][x], b[y][x], x, y);\n      }\n    }\n  }\n}\n\nmodule.exports = Array2D;\n","function getTileTypeId(config, type) {\n  const entry = Object.entries(config.tileTypes).find(([, props]) => props.type === type);\n  return entry ? Number(entry[0]) : null;\n}\n\nfunction getTileType(config, type) {\n  const entry = Object.entries(config.tileTypes).find(([, props]) => props.type === type);\n  return entry ? entry[1] : null;\n}\n\nmodule.exports = { getTileTypeId, getTileType };\n","// https://github.com/mourner/flatqueue\n\n/**\n ISC License\n\n Copyright (c) 2021, Vladimir Agafonkin\n\n Permission to use, copy, modify, and/or distribute this software for any purpose\n with or without fee is hereby granted, provided that the above copyright notice\n and this permission notice appear in all copies.\n\n THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\n TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\n THIS SOFTWARE.\n Â© 2021 GitHub, Inc.\n Terms\n Privacy\n\n */\nclass FlatQueue {\n\n  constructor() {\n    this.ids = [];\n    this.values = [];\n    this.length = 0;\n  }\n\n  clear() {\n    this.length = 0;\n  }\n\n  push(id, value) {\n    let pos = this.length++;\n    this.ids[pos] = id;\n    this.values[pos] = value;\n\n    while (pos > 0) {\n      const parent = (pos - 1) >> 1;\n      const parentValue = this.values[parent];\n      if (value >= parentValue) break;\n      this.ids[pos] = this.ids[parent];\n      this.values[pos] = parentValue;\n      pos = parent;\n    }\n\n    this.ids[pos] = id;\n    this.values[pos] = value;\n  }\n\n  pop() {\n    if (this.length === 0) return undefined;\n\n    const top = this.ids[0];\n    this.length--;\n\n    if (this.length > 0) {\n      const id = this.ids[0] = this.ids[this.length];\n      const value = this.values[0] = this.values[this.length];\n      const halfLength = this.length >> 1;\n      let pos = 0;\n\n      while (pos < halfLength) {\n        let left = (pos << 1) + 1;\n        const right = left + 1;\n        let bestIndex = this.ids[left];\n        let bestValue = this.values[left];\n        const rightValue = this.values[right];\n\n        if (right < this.length && rightValue < bestValue) {\n          left = right;\n          bestIndex = this.ids[right];\n          bestValue = rightValue;\n        }\n        if (bestValue >= value) break;\n\n        this.ids[pos] = bestIndex;\n        this.values[pos] = bestValue;\n        pos = left;\n      }\n\n      this.ids[pos] = id;\n      this.values[pos] = value;\n    }\n\n    return top;\n  }\n\n  peek() {\n    if (this.length === 0) return undefined;\n    return this.ids[0];\n  }\n\n  peekValue() {\n    if (this.length === 0) return undefined;\n    return this.values[0];\n  }\n\n  shrink() {\n    this.ids.length = this.values.length = this.length;\n  }\n}\n\nmodule.exports = FlatQueue;\n","function showFatalError(text, error) {\n  $('<div></div>')\n    .addClass('fatal-error')\n    .append($('<div></div>')\n      .addClass('fatal-error-text')\n      .html(text))\n    .append($('<div></div>')\n      .addClass('fatal-error-details')\n      .html(error.message))\n    .appendTo('body');\n\n  $('html').addClass('with-fatal-error');\n}\n\nmodule.exports = showFatalError;\n","function average(data) {\n  return data.length > 0 ? data.reduce((a, b) => a + b, 0) / data.length : undefined;\n}\n\nfunction sortedQuantile(sortedData, q) {\n  if (sortedData.length === 0) {\n    return undefined;\n  }\n  const pos = (sortedData.length - 1) * q;\n  const base = Math.floor(pos);\n  const rest = pos - base;\n  if (sortedData[base + 1] !== undefined) {\n    return sortedData[base] + rest * (sortedData[base + 1] - sortedData[base]);\n  }\n  return sortedData[base];\n}\n\nfunction quantile(data, q) {\n  return sortedQuantile(data.sort((a, b) => a - b), q);\n}\n\nfunction median(data) {\n  return quantile(data, 0.5);\n}\n\nfunction sortedMedian(data) {\n  return sortedQuantile(data, 0.5);\n}\n\nfunction firstQuartile(data) {\n  return quantile(data, 0.25);\n}\n\nfunction sortedFirstQuartile(data) {\n  return sortedQuantile(data, 0.25);\n}\n\nfunction thirdQuartile(data) {\n  return quantile(data, 0.75);\n}\n\nfunction sortedThirdQuartile(data) {\n  return sortedQuantile(data, 0.75);\n}\n\nfunction numberUnderValue(data, k) {\n  let count = 0;\n  for (let i = 0; i < data.length; i += 1) {\n    if (data[i] < k) {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nfunction percentageUnderValue(data, k) {\n  return data.length > 0 ? numberUnderValue(data, k) / data.length : 1;\n}\n\nfunction numberOverValue(data, k) {\n  let count = 0;\n  for (let i = 0; i < data.length; i += 1) {\n    if (data[i] > k) {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nfunction percentageOverValue(data, k) {\n  return data.length > 0 ? numberOverValue(data, k) / data.length : 1;\n}\n\nfunction numberOverEqValue(data, k) {\n  let count = 0;\n  for (let i = 0; i < data.length; i += 1) {\n    if (data[i] >= k) {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nfunction percentageOverEqValue(data, k) {\n  return data.length > 0 ? numberOverEqValue(data, k) / data.length : 1;\n}\n\nfunction numberEqualValue(data, k) {\n  let count = 0;\n  for (let i = 0; i < data.length; i += 1) {\n    if (data[i] === k) {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nfunction percentageEqualValue(data, k) {\n  return data.length > 0 ? numberEqualValue(data, k) / data.length : 1;\n}\n\nmodule.exports = {\n  average,\n  quantile,\n  sortedQuantile,\n  median,\n  sortedMedian,\n  firstQuartile,\n  sortedFirstQuartile,\n  thirdQuartile,\n  sortedThirdQuartile,\n  numberUnderValue,\n  percentageUnderValue,\n  numberOverValue,\n  percentageOverValue,\n  numberOverEqValue,\n  percentageOverEqValue,\n  numberEqualValue,\n  percentageEqualValue,\n};\n","const FlatQueue = require('./flatqueue');\nconst Array2D = require('./array-2d');\n\n/**\n * @callback timeFunctionCallback\n * @param tileTypeFrom\n * @param tileTypeTo\n * @return {Number}\n */\n/**\n * Given a city map and a starting point it returns the travel time to all other cells.\n *\n * Uses [Uniform Cost Search](https://www.redblobgames.com/pathfinding/a-star/introduction.html),\n * a variation on Dijkstra's algorithm.\n *\n * @param {Grid} map\n * @param {number} startX\n * @param {number} startY\n * @param {timeFunctionCallback} timeFunction\n * @return {number[][]}\n */\nfunction travelTimes(map, [startX, startY], timeFunction) {\n  const answer = Array2D.create(map.width, map.height, null);\n  const frontier = new FlatQueue();\n  frontier.push([startX, startY, map.get(startX, startY)], 0);\n  answer[startY][startX] = 0;\n\n  while (frontier.length > 0) {\n    const [currX, currY, currTile] = frontier.pop();\n    map.adjacentCells(currX, currY)\n      .forEach(([nextX, nextY, nextTile]) => {\n        const newCost = answer[currY][currX] + timeFunction(currTile, nextTile);\n        const nextCost = answer[nextY][nextX];\n        if (nextCost === null || newCost < nextCost) {\n          answer[nextY][nextX] = newCost;\n          frontier.push([nextX, nextY, nextTile], newCost);\n        }\n      });\n  }\n\n  return answer;\n}\n\nmodule.exports = travelTimes;\n","const Grid = require('./grid');\nconst Array2D = require('./aux/array-2d');\n\nclass City {\n  constructor(width, height, cells = null) {\n    this.map = new Grid(width, height, cells);\n  }\n\n  toJSON() {\n    const { map } = this;\n    return {\n      map: map.toJSON(),\n    };\n  }\n\n  static fromJSON(jsonObject) {\n    const { map } = jsonObject;\n    if (Array.isArray(map)) {\n      // Support old serialization format\n      return new City(16, 16, Array2D.fromFlat(16, 16, map.map(v => Number(v))));\n    }\n    const { width, height } = map;\n\n    // Support old serialization format\n    const cells = Array2D.isValid(map.cells)\n      ? Array2D.clone(map.cells)\n      : Array2D.fromFlat(width, height, map.cells.map(v => Number(v)));\n    return new City(width, height, cells);\n  }\n\n  copy(city) {\n    this.map.copy(city.map);\n  }\n}\n\nmodule.exports = City;\n","class ConnectionStateView {\n  constructor(connector) {\n    this.$element = $('<div></div>')\n      .addClass('connection-state-view');\n\n    this.$errorMessage = $('<div></div>')\n      .addClass('connection-state-view-error text-danger')\n      .appendTo(this.$element);\n    this.$errorStatus = $('<div></div>')\n      .addClass('connection-state-view-status')\n      .appendTo(this.$element);\n\n    connector.events.on('disconnect', this.handleDisconnect.bind(this));\n    connector.events.on('connectWait', this.handleConnectWait.bind(this));\n    connector.events.on('connecting', this.handleConnecting.bind(this));\n    connector.events.on('connect', this.handleConnect.bind(this));\n  }\n\n  show() {\n    this.$element.addClass('visible');\n  }\n\n  hide() {\n    this.$element.removeClass('visible');\n  }\n\n  setErrorMessage(message) {\n    this.$errorMessage.html(message);\n  }\n\n  setErrorStatus(status) {\n    this.$errorStatus.html(status);\n  }\n\n  handleDisconnect() {\n    this.setErrorMessage('Disconnected from server');\n    this.setErrorStatus('');\n    this.show();\n  }\n\n  handleConnectWait() {\n    this.setErrorStatus('Waiting to reconnect...');\n  }\n\n  handleConnecting() {\n    this.setErrorStatus('Connecting...');\n  }\n\n  handleConnect() {\n    this.hide();\n  }\n}\n\nmodule.exports = ConnectionStateView;\n","const EventEmitter = require('events');\n\nclass DataManager {\n  constructor(userOptions = {}) {\n    this.options = Object.assign({}, DataManager.DefaultOptions, userOptions);\n    this.sources = [];\n    this.variables = {};\n    this.events = new EventEmitter();\n\n    this.calculationPending = false;\n    this.cooldownTimer = null;\n  }\n\n  /**\n   * Add a new data source to the data manager.\n   *\n   * @param {DataSource} dataSource\n   */\n  registerSource(dataSource) {\n    if (this.sources.includes(dataSource)) {\n      throw new Error(`Source ${dataSource.constructor.name} already registered.`);\n    }\n    this.sources.push(dataSource);\n    dataSource.dataManager = this;\n\n    Object.entries(dataSource.getVariables()).forEach(([id, callback]) => {\n      if (this.variables[id] !== undefined) {\n        throw new Error(`Source ${dataSource.constructor.name} registering already registered variable ${id}.`);\n      }\n      this.variables[id] = callback;\n    });\n  }\n\n  /**\n   * Get the value of a variable.\n   *\n   * @param {string} variableId\n   * @return {*}\n   */\n  get(variableId) {\n    if (this.variables[variableId] === undefined) {\n      throw new Error(`Requested unknown variable ${variableId}.`);\n    }\n    return this.variables[variableId]();\n  }\n\n  throttledCalculateAll() {\n    this.calculationPending = true;\n    if (this.cooldownTimer === null) {\n      this.cooldownTimer = setTimeout(() => {\n        this.cooldownTimer = null;\n        if (this.calculationPending) {\n          this.throttledCalculateAll();\n        }\n      }, this.options.throttleTime);\n      this.calculateAll();\n      this.calculationPending = false;\n    }\n  }\n\n  calculateAll() {\n    this.sources.forEach((source) => {\n      source.calculate();\n    });\n    this.events.emit('update');\n  }\n\n  getGoals() {\n    return this.sources.reduce((acc, source) => acc.concat(source.getGoals()), []);\n  }\n}\n\nDataManager.DefaultOptions = {\n  throttleTime: 1000,\n};\n\nmodule.exports = DataManager;\n","class DataSource {\n  /**\n   * Get the list of variables provided by this data source.\n   *\n   * Provides a map of callbacks that return the data of the variable.\n   *\n   * @return {Object.<string, function>}\n   */\n  // eslint-disable-next-line class-methods-use-this\n  getVariables() {\n    return {};\n  }\n\n  /**\n   * Computes the values of all variables provided by this source.\n   */\n  calculate() {\n  }\n\n  /**\n   * Gets the list of goals provided by this data source.\n   * @return {*[]}\n   */\n  getGoals() {\n    return [];\n  }\n\n  goalProgress(currValue, goal) {\n    return Math.max(0, Math.min(1, (currValue / goal) || 0));\n  }\n}\n\nmodule.exports = DataSource;\n","const DataSource = require('../data-source');\nconst Array2D = require('../aux/array-2d');\nconst { getTileTypeId } = require('../aux/config-helpers');\nconst { percentageEqualValue, percentageOverEqValue } = require('../aux/statistics');\n\nclass NoiseData extends DataSource {\n  constructor(city, config) {\n    super();\n    this.city = city;\n    this.config = config;\n    this.noiseMap = Array2D.create(this.city.map.width, this.city.map.height);\n    this.noise = [];\n    this.residentialNoise = [];\n\n    this.maxLevel = this.config.goals.noise['max-noise-level'] || 1;\n    this.highLevel = this.config.goals.noise['high-noise-level'] || 0.5;\n    this.medLevel = this.config.goals.noise['med-noise-level'] || 0.25;\n\n    this.maxNoiseGoalPct = this.config.goals.noise['max-noise-goal-percentage'] || 0.05;\n    this.highNoiseGoalPct = this.config.goals.noise['high-noise-goal-percentage'] || 0.5;\n    this.residentialHighNoiseGoalPct = this.config.goals\n      .noise['residential-high-noise-goal-percentage'] || 0.5;\n    this.residentialMedNoiseGoalPct = this.config.goals\n      .noise['residential-med-noise-goal-percentage'] || 0.5;\n\n    this.maxNoisePct = 0;\n    this.highNoisePct = 0;\n    this.highNoiseResidentialPct = 0;\n    this.medNoiseResidentialPct = 0;\n  }\n\n  getVariables() {\n    return {\n      noise: () => this.noise,\n      'noise-residential': () => this.residentialNoise,\n      'noise-map': () => this.noiseMap,\n      'noise-index': () => this.getNoiseIndex(),\n    };\n  }\n\n  calculate() {\n    Array2D.setAll(this.noiseMap, 0);\n    Array2D.forEach(this.city.map.cells, (v, x, y) => {\n      const noise = (this.config.tileTypes[v] && this.config.tileTypes[v].noise) || 0;\n      if (noise !== 0) {\n        this.noiseMap[y][x] += noise;\n        this.city.map.nearbyCoords(x, y, 1).forEach(([nx, ny]) => {\n          this.noiseMap[ny][nx] += noise * 0.5;\n        });\n      }\n    });\n    Array2D.forEach(this.noiseMap, (v, x, y) => {\n      this.noiseMap[y][x] = Math.min(NoiseData.MaxValue, Math.max(NoiseData.MinValue, v));\n    });\n\n    this.noise = Array2D.flatten(this.noiseMap);\n\n    this.residentialNoise = [];\n    const residentialTileId = getTileTypeId(this.config, 'residential');\n    Array2D.zip(this.city.map.cells, this.noiseMap, (tile, value) => {\n      if (tile === residentialTileId) {\n        this.residentialNoise.push(value);\n      }\n    });\n\n    this.maxNoisePct = percentageEqualValue(this.noise, this.maxLevel);\n    this.highNoisePct = percentageOverEqValue(this.noise, this.highLevel);\n    this.highNoiseResidentialPct = percentageOverEqValue(this.residentialNoise, this.highLevel);\n    this.medNoiseResidentialPct = percentageOverEqValue(this.residentialNoise, this.medLevel);\n  }\n\n  getNoiseIndex() {\n    return 1\n      // percentage of tiles with max noise under 5%\n      + (this.maxNoisePct < this.maxNoiseGoalPct ? 1 : 0)\n      // percentage of tiles with noise 0.5 or more under 50%\n      + (this.highNoisePct < this.highNoiseGoalPct ? 1 : 0)\n      // percentage of residential tiles with noise 0.5 or more under 50%\n      + (this.highNoiseResidentialPct < this.residentialHighNoiseGoalPct ? 1 : 0)\n      // percentage of residential tiles with noise 0.25 or more under 50%\n      + (this.medNoiseResidentialPct < this.residentialMedNoiseGoalPct ? 1 : 0);\n  }\n\n  getGoals() {\n    return [\n      {\n        id: 'noise-city',\n        category: 'noise',\n        priority: 1,\n        condition: this.highNoisePct < this.highNoiseGoalPct,\n        progress: this.goalProgress(1 - this.highNoisePct, 1 - this.highNoiseGoalPct),\n      },\n      {\n        id: 'noise-residential',\n        category: 'noise',\n        priority: 2,\n        condition: this.medNoiseResidentialPct < this.residentialMedNoiseGoalPct,\n        progress: this.goalProgress(1 - this.medNoiseResidentialPct,\n          1 - this.residentialMedNoiseGoalPct),\n      },\n      {\n        id: 'noise-max',\n        category: 'noise',\n        priority: 3,\n        condition: this.maxNoisePct < this.maxNoiseGoalPct,\n        progress: this.goalProgress(1 - this.maxNoisePct, 1 - this.maxNoiseGoalPct),\n      },\n    ];\n  }\n}\n\nNoiseData.MinValue = 0;\nNoiseData.MaxValue = 1;\n\nmodule.exports = NoiseData;\n","const DataSource = require('../data-source');\nconst Array2D = require('../aux/array-2d');\nconst { getTileTypeId } = require('../aux/config-helpers');\nconst { percentageEqualValue, percentageOverValue } = require('../aux/statistics');\n\nclass PollutionData extends DataSource {\n  constructor(city, config) {\n    super();\n    this.city = city;\n    this.config = config;\n\n    this.pollutionMap = Array2D.create(this.city.map.width, this.city.map.height);\n    this.pollution = [];\n    this.residentialPollution = [];\n\n    this.maxLevel = this.config.goals.pollution['max-pollution-level'] || 1;\n    this.highLevel = this.config.goals.pollution['high-pollution-level'] || 0.3;\n    this.highResidentialLevel = this.config.goals.pollution['high-residential-pollution-level'] || 0.2;\n    this.medResidentialLevel = this.config.goals.pollution['med-residential-pollution-level'] || 0.1;\n\n    this.maxPollutionGoalPct = this.config.goals.pollution['max-pollution-goal-percentage'] || 0.05;\n    this.highPollutionGoalPct = this.config.goals.pollution['high-pollution-goal-percentage'] || 0.5;\n    this.residentialHighPollutionGoalPct = this.config.goals\n      .pollution['residential-high-pollution-goal-percentage'] || 0.5;\n    this.residentialMedPollutionGoalPct = this.config.goals\n      .pollution['residential-med-pollution-goal-percentage'] || 0.5;\n\n    this.maxPollutionPct = 0;\n    this.highPollutionPct = 0;\n    this.residentialHighPollutionPct = 0;\n    this.residentialMedPollutionPct = 0;\n  }\n\n  getVariables() {\n    return {\n      pollution: () => this.pollution,\n      'pollution-residential': () => this.residentialPollution,\n      'pollution-map': () => this.pollutionMap,\n      'pollution-index': () => this.getPollutionIndex(),\n    };\n  }\n\n  calculate() {\n    Array2D.setAll(this.pollutionMap, 0);\n    Array2D.forEach(this.city.map.cells, (v, x, y) => {\n      const emissions = (this.config.tileTypes[v] && this.config.tileTypes[v].emissions) || 0;\n      if (emissions !== 0) {\n        this.pollutionMap[y][x] += emissions;\n        this.city.map.nearbyCoords(x, y, 1).forEach(([nx, ny]) => {\n          this.pollutionMap[ny][nx] += emissions * 0.5;\n        });\n        this.city.map.nearbyCoords(x, y, 2).forEach(([nx, ny]) => {\n          this.pollutionMap[ny][nx] += emissions * 0.25;\n        });\n      }\n    });\n    Array2D.forEach(this.pollutionMap, (v, x, y) => {\n      this.pollutionMap[y][x] = Math.min(PollutionData.MaxValue,\n        Math.max(PollutionData.MinValue, v));\n    });\n\n    this.pollution = Array2D.flatten(this.pollutionMap);\n\n    this.residentialPollution = [];\n    const residentialTileId = getTileTypeId(this.config, 'residential');\n    Array2D.zip(this.city.map.cells, this.pollutionMap, (tile, value) => {\n      if (tile === residentialTileId) {\n        this.residentialPollution.push(value);\n      }\n    });\n\n    this.maxPollutionPct = percentageEqualValue(this.pollution, this.maxLevel);\n    this.highPollutionPct = percentageOverValue(this.pollution, this.highLevel);\n    this.residentialHighPollutionPct = percentageOverValue(this.residentialPollution,\n      this.highResidentialLevel);\n    this.residentialMedPollutionPct = percentageOverValue(this.residentialPollution,\n      this.medResidentialLevel);\n  }\n\n  getPollutionIndex() {\n    return 1\n      // percentage of tiles with max pollution under 5%\n      + (this.maxPollutionPct < this.maxPollutionGoalPct ? 1 : 0)\n      // percentage of tiles with pollution 0.3 or more under 50%\n      + (this.highPollutionPct < this.highPollutionGoalPct ? 1 : 0)\n      // percentage of residential tiles with pollution 0.2 or more under 50%\n      + (this.residentialHighPollutionPct < this.residentialHighPollutionGoalPct ? 1 : 0)\n      // percentage of residential tiles with pollution 0.1 or more under 50%\n      + (this.residentialMedPollutionPct < this.residentialMedPollutionGoalPct ? 1 : 0);\n  }\n\n  getGoals() {\n    return [\n      {\n        id: 'pollution-city',\n        category: 'pollution',\n        priority: 1,\n        condition: this.highPollutionPct < this.highPollutionGoalPct,\n        progress: this.goalProgress(1 - this.highPollutionPct, 1 - this.highPollutionGoalPct),\n      },\n      {\n        id: 'pollution-residential',\n        category: 'pollution',\n        priority: 2,\n        condition: this.residentialMedPollutionPct < this.residentialMedPollutionGoalPct,\n        progress: this.goalProgress(1 - this.residentialMedPollutionPct,\n          1 - this.residentialMedPollutionGoalPct),\n      },\n      {\n        id: 'pollution-max',\n        category: 'pollution',\n        priority: 3,\n        condition: this.maxPollutionPct < this.maxPollutionGoalPct,\n        progress: this.goalProgress(1 - this.maxPollutionPct, 1 - this.maxPollutionGoalPct),\n      },\n    ];\n  }\n}\n\nPollutionData.MinValue = 0;\nPollutionData.MaxValue = 1;\n\nmodule.exports = PollutionData;\n","const City = require('../city');\n\nclass CityBrowser {\n  constructor($element, config, cityStore, saveMode = false) {\n    this.$element = $element;\n    this.config = config;\n    this.$selectedButton = null;\n    this.selectedData = null;\n\n    this.$element.addClass('city-browser');\n\n    const setSelection = (button) => {\n      if (this.$selectedButton) {\n        this.$selectedButton.removeClass('selected');\n      }\n      this.$selectedButton = $(button);\n      this.$selectedButton.addClass('selected');\n    };\n\n    const buttons = Object.entries(\n      saveMode ? cityStore.getAllUserObjects() : cityStore.getAllObjects()\n    ).map(([id, cityJSON]) => $('<div></div>')\n      .addClass(['col-6', 'col-md-2', 'mb-3'])\n      .append(\n        $('<button></button>')\n          .addClass('city-browser-item')\n          .append(this.createPreviewImage(cityJSON))\n          .on('click', (ev) => {\n            setSelection(ev.currentTarget);\n            this.selectedData = id;\n          })\n      ));\n\n    if (saveMode) {\n      buttons.unshift($('<div></div>')\n        .addClass(['col-6', 'col-md-2', 'mb-3'])\n        .append($('<button></button>')\n          .addClass('city-browser-item-new')\n          .on('click', (ev) => {\n            setSelection(ev.currentTarget);\n            this.selectedData = 'new';\n          })));\n    }\n\n    this.$element.append($('<div class=\"row\"></div>').append(buttons));\n  }\n\n  createPreviewImage(cityJSON) {\n    const $canvas = $('<canvas class=\"city-browser-item-preview\"></canvas>')\n      .attr({\n        width: this.config.cityWidth,\n        height: this.config.cityHeight,\n      });\n    const city = City.fromJSON(cityJSON);\n    const ctx = $canvas[0].getContext('2d');\n    city.map.allCells().forEach(([i, j, value]) => {\n      ctx.fillStyle = (this.config.tileTypes && this.config.tileTypes[value].color) || '#000000';\n      ctx.fillRect(i, j, 1, 1);\n    });\n\n    return $canvas;\n  }\n}\n\nmodule.exports = CityBrowser;\n","const EventEmitter = require('events');\n\nclass MapEditorPalette {\n  constructor($element, config) {\n    this.$element = $element;\n    this.config = config;\n    this.activeButton = null;\n    this.tileId = null;\n    this.events = new EventEmitter();\n\n    this.$element.addClass('map-editor-palette');\n\n    this.buttons = Object.entries(config.tileTypes).map(([id, typeCfg]) => $('<button></button>')\n      .attr({\n        type: 'button',\n        title: typeCfg.name,\n      })\n      .addClass([\n        'editor-palette-button',\n        'editor-palette-button-tile',\n        `editor-palette-button-tile-${id}`,\n      ])\n      .css({\n        backgroundColor: typeCfg.color,\n        backgroundImage: `url(${typeCfg.editorIcon})`,\n      })\n      .on('click', (ev) => {\n        if (this.activeButton) {\n          this.activeButton.removeClass('active');\n        }\n        this.activeButton = $(ev.target);\n        this.activeButton.addClass('active');\n        this.tileId = Number(id);\n        this.events.emit('change', 'tile', Number(id));\n      }));\n\n    this.buttons.push($('<div class=\"separator\"></div>'));\n\n    this.toolButtons = [\n      $('<button></button>')\n        .attr({type: 'button', title: 'Measure distance'})\n        .addClass([\n          'editor-palette-button',\n          'editor-palette-button-tool',\n          'editor-palette-button-tool-distance',\n        ])\n        .css({\n          backgroundImage: 'url(\\'static/fa/ruler-horizontal-solid.svg\\')',\n        })\n        .on('click', (ev) => {\n          if (this.activeButton) {\n            this.activeButton.removeClass('active');\n          }\n          this.activeButton = $(ev.target);\n          this.activeButton.addClass('active');\n          this.tileId = null;\n          this.events.emit('change', 'measureDistance');\n          // this.events.emit('action', 'measureDistance',);\n        }),\n    ];\n\n    this.buttons.push(...this.toolButtons);\n\n    this.buttons.push($('<div class=\"separator\"></div>'));\n\n    const actionButtons = MapEditorPalette.Actions.map(action => $('<button></button>')\n      .attr({\n        type: 'button',\n        title: action.title,\n      })\n      .addClass([\n        'editor-palette-button',\n        'editor-palette-button-action',\n        `editor-palette-button-action-${action.id}`,\n      ])\n      .css({\n        backgroundImage: `url(${action.icon})`,\n      })\n      .on('click', () => {\n        this.events.emit('action', action.id);\n      }));\n\n    this.buttons.push(...actionButtons);\n\n    this.$element.append(this.buttons);\n    if (this.buttons.length) {\n      this.buttons[0].click();\n    }\n  }\n}\n\nMapEditorPalette.Actions = [\n  {\n    id: 'load',\n    title: 'Load map',\n    icon: 'static/fa/folder-open-solid.svg',\n  },\n  {\n    id: 'save',\n    title: 'Save map',\n    icon: 'static/fa/save-solid.svg',\n  },\n  {\n    id: 'import',\n    title: 'Import map',\n    icon: 'static/fa/file-import-solid.svg',\n  },\n  {\n    id: 'export',\n    title: 'Export map',\n    icon: 'static/fa/file-export-solid.svg',\n  },\n];\n\nmodule.exports = MapEditorPalette;\n","const EventEmitter = require('events');\nconst City = require('../city');\nconst MapView = require('../map-view');\nconst MapEditorPalette = require('./map-editor-palette');\nconst ModalLoad = require('./modal-load');\nconst ModalSave = require('./modal-save');\nconst ModalExport = require('./modal-export');\nconst ModalImport = require('./modal-import');\nconst ObjectStore = require('./object-store');\nconst MapTextOverlay = require('../map-text-overlay');\nconst travelTimes = require('../aux/travel-times');\nconst { getTileTypeId } = require('../aux/config-helpers');\nconst Array2D = require('../aux/array-2d');\n\nclass MapEditor {\n  constructor($element, city, config, textures) {\n    this.$element = $element;\n    this.city = city;\n    this.config = config;\n\n    this.events = new EventEmitter();\n    this.mapView = new MapView(city, config, textures);\n    this.mapView.enableTileInteractivity();\n    this.displayObject = this.mapView.displayObject;\n    this.textOverlay = new MapTextOverlay(this.mapView);\n\n    this.palette = new MapEditorPalette($('<div></div>').appendTo(this.$element), config);\n\n    this.tool = null;\n    this.tileType = this.palette.tileId;\n    this.palette.events.on('change', (tool, toolType) => {\n      if (this.tool) {\n        this.tools[this.tool].end();\n      }\n      this.tool = tool;\n      this.tileType = toolType;\n      this.tools[this.tool].start();\n    });\n\n    this.palette.events.on('action', (id) => {\n      if (this.actionHandlers[id]) {\n        this.actionHandlers[id]();\n      }\n    });\n\n    let lastEdit = null;\n    this.mapView.events.on('action',\n      (...args) => this.tools[this.tool].action(...args));\n\n    this.objectStore = new ObjectStore('./cities.json');\n    this.actionHandlers = {\n      load: () => {\n        const modal = new ModalLoad(this.config, this.objectStore);\n        modal.show().then((id) => {\n          const jsonCity = id && this.objectStore.get(id);\n          if (jsonCity) {\n            this.city.copy(City.fromJSON(jsonCity));\n          }\n        });\n      },\n      save: () => {\n        const modal = new ModalSave(this.config, this.objectStore);\n        modal.show().then((id) => {\n          if (id) {\n            this.objectStore.set(id === 'new' ? null : id, this.city.toJSON());\n          }\n        });\n      },\n      import: () => {\n        const modal = new ModalImport();\n        modal.show().then((importedData) => {\n          if (importedData) {\n            this.city.copy(City.fromJSON(importedData));\n          }\n        });\n      },\n      export: () => {\n        const modal = new ModalExport(JSON.stringify(this.city));\n        modal.show();\n      },\n    };\n\n    this.tools = {\n      tile: {\n        start: () => {\n          this.mapView.setEditCursor();\n        },\n        end: () => {\n\n        },\n        action: ([x, y], props) => {\n          if (this.tileType !== null) {\n            if (lastEdit && props.shiftKey) {\n              const [lastX, lastY] = lastEdit;\n              for (let i = Math.min(lastX, x); i <= Math.max(lastX, x); i += 1) {\n                for (let j = Math.min(lastY, y); j <= Math.max(lastY, y); j += 1) {\n                  this.city.map.set(i, j, this.tileType);\n                }\n              }\n            } else {\n              this.city.map.set(x, y, this.tileType);\n            }\n            lastEdit = [x, y];\n          }\n        },\n      },\n      measureDistance: {\n        start: () => {\n          this.mapView.setInspectCursor();\n          this.textOverlay.clear();\n          this.textOverlay.show();\n        },\n        end: () => {\n          this.textOverlay.hide();\n        },\n        action: ([startX, startY]) => {\n          const roadTileId = getTileTypeId(this.config, 'road');\n          const data = travelTimes(this.mapView.city.map, [startX, startY],\n            (tileFrom, tileTo) => (\n              (tileFrom === roadTileId && tileTo === roadTileId) ? 1 : 5));\n          // Normalize the data\n          // Array2D.forEach(data, (v, x, y) => {\n          //   const manhattan = Math.abs(startX - x) + Math.abs(startY - y);\n          //   data[y][x] = (manhattan > 0 ? v / manhattan : 0);\n          // });\n          this.textOverlay.display(data);\n\n          const residentalId = getTileTypeId(config, 'residential');\n          const commercialId = getTileTypeId(config, 'commercial');\n          const industrialId = getTileTypeId(config, 'industrial');\n          Array2D.zip(data, city.map.cells, (value, tile, x, y) => {\n            data[y][x] = (\n              (tile === residentalId || tile === commercialId || tile === industrialId)\n                ? value : null\n            );\n          });\n\n          this.events.emit('inspect', {\n            title: `Trip len from (${startX}, ${startY}) to RCI`,\n            values: Array2D.flatten(data).filter(v => v !== null),\n          });\n        },\n      },\n    };\n  }\n}\n\nmodule.exports = MapEditor;\n","const Modal = require('../modal');\n\nclass ModalExport extends Modal {\n  constructor(exportData) {\n    super({\n      title: 'Export map',\n    });\n\n    this.$dataContainer = $('<textarea class=\"form-control\"></textarea>')\n      .attr({\n        rows: 10,\n      })\n      .text(exportData)\n      .appendTo(this.$body);\n\n    this.$copyButton = $('<button></button>')\n      .addClass(['btn', 'btn-outline-dark', 'btn-copy', 'mt-2'])\n      .text('Copy to clipboard')\n      .on('click', () => {\n        this.$dataContainer[0].select();\n        document.execCommand('copy');\n        this.hide();\n      })\n      .appendTo(this.$footer);\n  }\n}\n\nmodule.exports = ModalExport;\n","const Modal = require('../modal');\n\nclass ModalImport extends Modal {\n  constructor() {\n    super({\n      title: 'Import map',\n    });\n\n    this.$dataContainer = $('<textarea class=\"form-control\"></textarea>')\n      .attr({\n        rows: 10,\n        placeholder: 'Paste the JSON object here.',\n      })\n      .appendTo(this.$body);\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$errorText = $('<p class=\"text-danger\"></p>')\n      .appendTo(this.$footer)\n      .hide();\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$copyButton = $('<button></button>')\n      .addClass(['btn', 'btn-primary'])\n      .text('Import')\n      .on('click', () => {\n        try {\n          const imported = JSON.parse(this.$dataContainer.val());\n          this.hide(imported);\n        } catch (err) {\n          this.showError(err.message);\n        }\n      })\n      .appendTo(this.$footer);\n  }\n\n  showError(errorText) {\n    this.$errorText.html(errorText);\n    this.$errorText.show();\n  }\n}\n\nmodule.exports = ModalImport;\n","const Modal = require('../modal');\nconst CityBrowser = require('./city-browser');\n\nclass ModalLoad extends Modal {\n  constructor(config, cityStore) {\n    super({\n      title: 'Load map',\n      size: 'lg',\n    });\n\n    this.$browserContainer = $('<div></div>')\n      .appendTo(this.$body);\n    this.browser = new CityBrowser(this.$browserContainer, config, cityStore);\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$cancelButton = $('<button></button>')\n      .addClass(['btn', 'btn-secondary'])\n      .text('Cancel')\n      .on('click', () => {\n        this.hide(null);\n      })\n      .appendTo(this.$footer);\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$loadButton = $('<button></button>')\n      .addClass(['btn', 'btn-primary'])\n      .text('Load')\n      .on('click', () => {\n        try {\n          this.hide(this.browser.selectedData);\n        } catch (err) {\n          this.showError(err.message);\n        }\n      })\n      .appendTo(this.$footer);\n  }\n\n  showError(errorText) {\n    this.$errorText.html(errorText);\n    this.$errorText.show();\n  }\n}\n\nmodule.exports = ModalLoad;\n","const Modal = require('../modal');\nconst CityBrowser = require('./city-browser');\n\nclass ModalSave extends Modal {\n  constructor(config, cityStore) {\n    super({\n      title: 'Save map',\n      size: 'lg',\n    });\n\n    this.$browserContainer = $('<div></div>')\n      .appendTo(this.$body);\n    this.browser = new CityBrowser(this.$browserContainer, config, cityStore, true);\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$cancelButton = $('<button></button>')\n      .addClass(['btn', 'btn-secondary'])\n      .text('Cancel')\n      .on('click', () => {\n        this.hide(null);\n      })\n      .appendTo(this.$footer);\n\n    // noinspection JSUnusedGlobalSymbols\n    this.$saveButton = $('<button></button>')\n      .addClass(['btn', 'btn-primary'])\n      .text('Save')\n      .on('click', () => {\n        try {\n          this.hide(this.browser.selectedData);\n        } catch (err) {\n          this.showError(err.message);\n        }\n      })\n      .appendTo(this.$footer);\n  }\n\n  showError(errorText) {\n    this.$errorText.html(errorText);\n    this.$errorText.show();\n  }\n}\n\nmodule.exports = ModalSave;\n","class ObjectStore {\n  constructor(fixedObjectsPath = null) {\n    this.fixedObjects = [];\n    this.userObjects = [];\n\n    this.loadUserObjects();\n    if (fixedObjectsPath) {\n      this.loadFixedObjects(fixedObjectsPath);\n    }\n  }\n\n  async loadFixedObjects(path) {\n    fetch(path, { cache: 'no-store' })\n      .then(response => response.json())\n      .then((data) => {\n        this.fixedObjects = data.cities;\n      });\n  }\n\n  loadUserObjects() {\n    const userObjects = JSON.parse(localStorage.getItem('futureMobility.cityStore.cities'));\n    if (userObjects) {\n      this.userObjects = userObjects;\n    }\n  }\n\n  saveLocal() {\n    localStorage.setItem('futureMobility.cityStore.cities', JSON.stringify(this.userObjects));\n  }\n\n  getAllObjects() {\n    return Object.assign(\n      {},\n      this.getAllUserObjects(),\n      this.getAllFixedObjects(),\n    );\n  }\n\n  getAllFixedObjects() {\n    return Object.fromEntries(this.fixedObjects.map((obj, i) => [\n      `F${i}`,\n      obj,\n    ]));\n  }\n\n  getAllUserObjects() {\n    return Object.fromEntries(this.userObjects.map((obj, i) => [\n      `L${i}`,\n      obj,\n    ]).reverse());\n  }\n\n  get(id) {\n    if (id[0] === 'F') {\n      return this.fixedObjects[id.substr(1)];\n    }\n    return this.userObjects[id.substr(1)];\n  }\n\n  set(id, obj) {\n    if (id === null || this.userObjects[id.substr(1)] === undefined) {\n      this.userObjects.push(obj);\n    } else {\n      this.userObjects[id.substr(1)] = obj;\n    }\n    this.saveLocal();\n  }\n}\n\nmodule.exports = ObjectStore;\n","const EventEmitter = require('events');\nconst Array2D = require('./aux/array-2d');\n\n/**\n * Represents a 2D grid map that stores a single Number per cell\n */\nclass Grid {\n  /**\n   * Create a new grid\n   *\n   * @param {number} width\n   * @param {number} height\n   * @param {number[][]} cells\n   */\n  constructor(width, height, cells = null) {\n    this.width = width;\n    this.height = height;\n    this.cells = cells || Array2D.create(width, height, 0);\n    this.events = new EventEmitter();\n  }\n\n  /**\n   * Create a new Grid from a JSON string\n   *\n   * @param jsonObject {object} JSON object\n   * @return {Grid}\n   */\n  static fromJSON(jsonObject) {\n    const { width, height, cells } = jsonObject;\n    return new Grid(width, height, cells);\n  }\n\n  /**\n   * Serializes to a JSON object\n   * @return {{cells: number[][], width: number, height: number}}\n   */\n  toJSON() {\n    return {\n      width: this.width,\n      height: this.height,\n      cells: Array2D.clone(this.cells),\n    };\n  }\n\n  copy(grid) {\n    this.width = grid.width;\n    this.height = grid.height;\n    this.replace(grid.cells);\n  }\n\n  /**\n   * Retrieves the value at (x,y)\n   *\n   * @param {number} x\n   * @param {number} y\n   * @return {number}\n   */\n  get(x, y) {\n    return this.cells[y][x];\n  }\n\n  /**\n   * Set the value at (x, y)\n   *\n   * @fires Grid.events#update\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} value\n   */\n  set(x, y, value) {\n    this.cells[y][x] = value;\n\n    /**\n     * Update event.\n     *\n     * Argument is an array of updated cells. Each updated cell is represented\n     * by an array with three elements: [x, y, value]\n     *\n     * @event Grid.events#update\n     * @type {[[number, number, number]]}\n     */\n    this.events.emit('update', [[x, y, value]]);\n  }\n\n  /**\n   * Backwards compatibility function that maps (x, y) to a single index in a flat array\n   * @deprecated\n   * @param x {number}\n   * @param y {number}\n   * @return {number}\n   */\n  offset(x, y) {\n    return y * this.width + x;\n  }\n\n  replace(cells) {\n    Array2D.copy(cells, this.cells);\n    this.events.emit('update', this.allCells());\n  }\n\n  /**\n   * Returns true if (x, y) are valid coordinates within the grid's bounds.\n   *\n   * @param {number} x\n   * @param {number} y\n   * @return {boolean}\n   */\n  isValidCoords(x, y) {\n    return x >= 0 && y >= 0 && x < this.width && y < this.height;\n  }\n\n  /**\n   * Returns all cells, represented as [x, y, value] arrays.\n   *\n   * @return {[[number, number, number]]}\n   */\n  allCells() {\n    return Array2D.items(this.cells);\n  }\n\n  /**\n   * Get cells adjacent to the cell at (i, j).\n   *\n   * Each cell is represented by an array of the form [i, j, value]\n   * A cell has at most four adjacent cells, which share one side\n   * (diagonals are not adjacent).\n   *\n   * @param {number} i\n   * @param {number} j\n   * @return {[[number, number, number]]}\n   */\n  adjacentCells(i, j) {\n    return [[i, j - 1], [i + 1, j], [i, j + 1], [i - 1, j]]\n      .filter(([x, y]) => this.isValidCoords(x, y))\n      .map(([x, y]) => [x, y, this.get(x, y)]);\n  }\n\n  /**\n   * Returns the coordinates of cells around the cell at (x, y).\n   *\n   * Each cells returned is represented as an array [x, y].\n   * Cells \"around\" are those reachable by no less than <distance> steps in\n   * any direction, including diagonals.\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} distance\n   * @return {[[number, number]]}\n   */\n  nearbyCoords(x, y, distance) {\n    const coords = [];\n    // Top\n    for (let i = x - distance; i < x + distance; i += 1) {\n      coords.push([i, y - distance]);\n    }\n    // Right\n    for (let i = y - distance; i < y + distance; i += 1) {\n      coords.push([x + distance, i]);\n    }\n    // Bottom\n    for (let i = x + distance; i > x - distance; i -= 1) {\n      coords.push([i, y + distance]);\n    }\n    // Left\n    for (let i = y + distance; i > y - distance; i -= 1) {\n      coords.push([x - distance, i]);\n    }\n\n    return coords\n      .filter(([eachX, eachY]) => this.isValidCoords(eachX, eachY));\n  }\n\n  /**\n   * Returns the cells around the cell at (x, y).\n   *\n   * Each cells returned is represented as an array [x, y, value].\n   * Cells \"around\" are those reachable by no less than <distance> steps in\n   * any direction, including diagonals.\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} distance\n   * @return {[[number, number, number]]}\n   */\n  nearbyCells(x, y, distance = 1) {\n    return this.nearbyCoords(x, y, distance)\n      .map(([nx, ny]) => [nx, ny, this.get(nx, ny)]);\n  }\n\n  /**\n   * Returns the frequency distribution of the values\n   * stored in the cells.\n   *\n   * @return {Object.<string, number>}\n   */\n  frequencyDistribution() {\n    const answer = {};\n    Array2D.forEach(this.cells, (v) => {\n      answer[v] = answer[v] === undefined ? 0 : answer[v] + 1;\n    });\n\n    return answer;\n  }\n}\n\nmodule.exports = Grid;\n","/* globals PIXI */\n\nconst MapView = require('./map-view');\nconst Array2D = require('./aux/array-2d');\n\nclass MapTextOverlay {\n  constructor(mapView) {\n    this.mapView = mapView;\n    this.visible = false;\n    this.fontSize = 32;\n    this.texts = Array2D.create(\n      this.mapView.city.map.width,\n      this.mapView.city.map.height,\n      null\n    );\n\n    this.displayObject = new PIXI.Container();\n    this.displayObject.visible = this.visible;\n    this.displayObject.zIndex = 1000;\n    this.mapView.addOverlay(this.displayObject);\n    this.createBackground();\n    this.createTexts();\n  }\n\n  createBackground() {\n    const background = new PIXI.Graphics();\n    background.beginFill(0, 0.75)\n      .drawRect(0, 0, this.mapView.displayObject.width, this.mapView.displayObject.height)\n      .endFill();\n    this.displayObject.addChild(background);\n  }\n\n  createTexts() {\n    Array2D.fill(this.texts, (x, y) => {\n      const text = new PIXI.Text('', {\n        fontFamily: 'Arial',\n        fontSize: this.fontSize,\n        fill: 'white',\n        align: 'center',\n      });\n      text.anchor.set(0.5, 0.5);\n      text.position.set(\n        MapView.TILE_SIZE * (x + 0.5),\n        MapView.TILE_SIZE * (y + 0.5)\n      );\n      this.displayObject.addChild(text);\n      return text;\n    });\n  }\n\n  clear() {\n    Array2D.forEach(this.texts, (each) => { each.text = ''; });\n  }\n\n  display(data) {\n    Array2D.zip(this.texts, data, (eachText, eachDataItem) => {\n      eachText.text = typeof eachDataItem === 'number' ? eachDataItem.toFixed(2) : eachDataItem;\n    });\n  }\n\n  show() {\n    this.visible = true;\n    this.displayObject.visible = true;\n  }\n\n  hide() {\n    this.visible = false;\n    this.displayObject.visible = false;\n  }\n}\n\nmodule.exports = MapTextOverlay;\n","/* globals PIXI */\nconst EventEmitter = require('events');\nconst Array2D = require('./aux/array-2d');\nconst { getTileTypeId } = require('./aux/config-helpers');\nconst PencilCursor = require('../../static/fa/pencil-alt-solid.svg');\n\nclass MapView {\n  constructor(city, config, textures) {\n    this.city = city;\n    this.config = config;\n    this.textures = textures;\n    this.events = new EventEmitter();\n    this.pointerActive = false;\n    this.roadTileId = getTileTypeId(config, 'road');\n    this.parkTileId = getTileTypeId(config, 'park');\n\n    this.randomizedTerrain = Array2D.create(this.city.map.width, this.city.map.height);\n    Array2D.fill(this.randomizedTerrain, () => Math.random());\n\n    this.displayObject = new PIXI.Container();\n\n    this.bgTiles = Array2D.create(this.city.map.width, this.city.map.height, null);\n    this.textureTiles = Array2D.create(this.city.map.width, this.city.map.height, null);\n\n    this.city.map.allCells().forEach(([x, y]) => {\n      const bgTile = new PIXI.Graphics();\n      bgTile.x = x * MapView.TILE_SIZE;\n      bgTile.y = y * MapView.TILE_SIZE;\n      this.bgTiles[y][x] = bgTile;\n\n      const textureTile = new PIXI.Sprite();\n      textureTile.x = x * MapView.TILE_SIZE;\n      textureTile.y = y * MapView.TILE_SIZE;\n      textureTile.width = MapView.TILE_SIZE;\n      textureTile.height = MapView.TILE_SIZE;\n      textureTile.roundPixels = true;\n      this.textureTiles[y][x] = textureTile;\n      this.renderTile(x, y);\n    });\n\n    this.displayObject.addChild(...Array2D.flatten(this.bgTiles));\n    this.displayObject.addChild(...Array2D.flatten(this.textureTiles));\n    this.overlayContainer = new PIXI.Container();\n    this.displayObject.addChild(this.overlayContainer);\n    this.gridOverlay = this.createGridOverlay();\n    this.displayObject.addChild(this.gridOverlay);\n    if (this.config.mapView && this.config.mapView.gridOverlay) {\n      this.renderGrid(this.config.mapView.gridOverlay);\n    }\n\n    this.city.map.events.on('update', this.handleCityUpdate.bind(this));\n    this.handleCityUpdate(this.city.map.allCells());\n  }\n\n  addOverlay(displayObject) {\n    this.overlayContainer.addChild(displayObject);\n    this.overlayContainer.sortChildren();\n  }\n\n  createGridOverlay() {\n    const overlay = new PIXI.Graphics();\n    overlay.x = 0;\n    overlay.y = 0;\n    overlay.width = this.city.map.width * MapView.TILE_SIZE;\n    overlay.height = this.city.map.height * MapView.TILE_SIZE;\n\n    return overlay;\n  }\n\n  setEditCursor() {\n    Array2D.items(this.bgTiles).forEach(([,, bgTile]) => {\n      bgTile.cursor = `url(${PencilCursor}) 0 20, auto`;\n    });\n  }\n\n  setInspectCursor() {\n    Array2D.items(this.bgTiles).forEach(([,, bgTile]) => {\n      bgTile.cursor = 'crosshair';\n    });\n  }\n\n  enableTileInteractivity() {\n    $(window).on('pointerup', () => { this.pointerActive = false; });\n\n    Array2D.items(this.bgTiles).forEach(([x, y, bgTile]) => {\n      bgTile.interactive = true;\n      bgTile.cursor = `url(${PencilCursor}) 0 20, auto`;\n      bgTile.on('pointerdown', (ev) => {\n        this.pointerActive = true;\n        this.events.emit('action', [x, y], {\n          shiftKey: ev.data.originalEvent.shiftKey,\n        });\n      });\n      bgTile.on('pointerover', (ev) => {\n        if (this.pointerActive) {\n          this.events.emit('action', [x, y], {\n            shiftKey: ev.data.originalEvent.shiftKey,\n          });\n        }\n      });\n    });\n  }\n\n  getBgTile(x, y) {\n    return this.bgTiles[y][x];\n  }\n\n  getTextureTile(x, y) {\n    return this.textureTiles[y][x];\n  }\n\n  renderTile(x, y) {\n    this.renderBasicTile(x, y);\n    if (this.city.map.get(x, y) === this.parkTileId) {\n      this.renderParkTile(x, y);\n    }\n    if (this.city.map.get(x, y) === this.roadTileId) {\n      this.renderRoadTile(x, y);\n    }\n  }\n\n  renderParkTile(x, y) {\n    const textureNumber = 1 + Math.round(this.randomizedTerrain[y][x] * 8);\n    this.getTextureTile(x, y).texture = this.textures[`park-0${textureNumber}`];\n    this.getTextureTile(x, y).visible = true;\n  }\n\n  renderRoadTile(i, j) {\n    const connMask = [[i, j - 1], [i + 1, j], [i, j + 1], [i - 1, j]]\n      .map(([x, y]) => (!this.city.map.isValidCoords(x, y)\n      || this.city.map.get(x, y) === this.roadTileId\n        ? '1' : '0')).join('');\n    this.getTextureTile(i, j).texture = this.textures[`road${connMask}`];\n    this.getTextureTile(i, j).visible = true;\n  }\n\n  renderBasicTile(i, j) {\n    const tileType = this.config.tileTypes[this.city.map.get(i, j)] || null;\n    this.getBgTile(i, j)\n      .clear()\n      .beginFill(tileType ? Number(`0x${tileType.color.substr(1)}`) : 0, 1)\n      .drawRect(0, 0, MapView.TILE_SIZE, MapView.TILE_SIZE)\n      .endFill();\n    this.getTextureTile(i, j).visible = false;\n  }\n\n  renderGrid(strokeWidth) {\n    const viewWidth = this.city.map.width * MapView.TILE_SIZE;\n    const viewHeight = this.city.map.height * MapView.TILE_SIZE;\n    this.gridOverlay.clear();\n    this.gridOverlay\n      .lineStyle(strokeWidth / 2, 0, 1, 1)\n      .moveTo(strokeWidth / 2, viewHeight - strokeWidth / 2)\n      .lineTo(strokeWidth / 2, strokeWidth / 2)\n      .lineTo(viewWidth - strokeWidth / 2, strokeWidth / 2)\n      .lineTo(viewWidth - strokeWidth / 2, viewHeight - strokeWidth / 2)\n      .lineTo(strokeWidth / 2, viewHeight - strokeWidth / 2)\n      .lineTo(strokeWidth / 2, viewHeight - strokeWidth);\n\n    this.gridOverlay.lineStyle(strokeWidth, 0, 1);\n    for (let i = 1; i < this.city.map.width; i += 1) {\n      this.gridOverlay.moveTo(i * MapView.TILE_SIZE, strokeWidth / 2)\n        .lineTo(i * MapView.TILE_SIZE, viewHeight - strokeWidth / 2);\n    }\n    for (let i = 1; i < this.city.map.height; i += 1) {\n      this.gridOverlay.moveTo(strokeWidth / 2, i * MapView.TILE_SIZE)\n        .lineTo(viewWidth - strokeWidth / 2, i * MapView.TILE_SIZE);\n    }\n  }\n\n  handleCityUpdate(updates) {\n    updates.forEach(([i, j]) => {\n      this.renderTile(i, j);\n      // Todo: This should be optimized so it's not called twice per frame for the same tile.\n      this.city.map.adjacentCells(i, j)\n        .filter(([x, y]) => this.city.map.get(x, y) === this.roadTileId)\n        .forEach(([x, y]) => this.renderRoadTile(x, y));\n    });\n  }\n\n  showGrid() {\n    this.gridOverlay.visible = true;\n  }\n\n  hideGrid() {\n    this.gridOverlay.visible = false;\n  }\n}\n\nMapView.TILE_SIZE = 120;\n\nmodule.exports = MapView;\n","class Modal {\n  /**\n   * @param {object} options\n   *  Modal dialog options\n   * @param {string} options.title\n   *  Dialog title.\n   * @param {string} options.size\n   *  Modal size (lg or sm).\n   * @param {boolean} options.showCloseButton\n   *  Shows a close button in the dialog if true.\n   * @param {boolean} options.showFooter\n   *  Adds a footer area to the dialog if true.\n   */\n  constructor(options) {\n    this.returnValue = null;\n\n    this.$element = $('<div class=\"modal fade\"></div>');\n    this.$dialog = $('<div class=\"modal-dialog\"></div>').appendTo(this.$element);\n    this.$content = $('<div class=\"modal-content\"></div>').appendTo(this.$dialog);\n    this.$header = $('<div class=\"modal-header\"></div>').appendTo(this.$content);\n    this.$body = $('<div class=\"modal-body\"></div>').appendTo(this.$content);\n    this.$footer = $('<div class=\"modal-footer\"></div>').appendTo(this.$content);\n\n    this.$closeButton = $('<button type=\"button\" class=\"close\" data-dismiss=\"modal\">')\n      .append($('<span>&times;</span>'))\n      .appendTo(this.$header);\n\n    if (options.title) {\n      $('<h5 class=\"modal-title\"></h5>')\n        .html(options.title)\n        .prependTo(this.$header);\n    }\n    if (options.size) {\n      this.$dialog.addClass(`modal-${options.size}`);\n    }\n\n    if (options.showCloseButton === false) {\n      this.$closeButton.remove();\n    }\n    if (options.showFooter === false) {\n      this.$footer.remove();\n    }\n  }\n\n  async show() {\n    return new Promise((resolve) => {\n      $('body').append(this.$element);\n      this.$element.modal();\n      this.$element.on('hidden.bs.modal', () => {\n        this.$element.remove();\n        resolve(this.returnValue);\n      });\n    });\n  }\n\n  hide(returnValue) {\n    this.returnValue = returnValue;\n    this.$element.modal('hide');\n  }\n}\n\nmodule.exports = Modal;\n","/* eslint-disable no-console */\nconst EventEmitter = require('events');\n\nconst PING_TIME = 1000 * 10;\nconst PONG_WAIT_TIME = 1000 * 10;\nconst RECONNECT_TIME = 1000 * 5;\n\nclass ServerSocketConnector {\n  constructor(uri) {\n    this.uri = uri;\n    this.ws = null;\n    this.connected = false;\n    this.events = new EventEmitter();\n    this.pingTimeout = null;\n    this.pongWaitTimeout = null;\n    this.reconnectTimeout = null;\n    this.connect();\n  }\n\n  connect() {\n    this.cancelPing();\n    this.cancelReconnect();\n\n    this.events.emit('connecting');\n    console.log(`Connecting to ${this.uri}...`);\n    this.ws = new WebSocket(this.uri);\n    this.ws.onopen = this.handleOpen.bind(this);\n    this.ws.onclose = this.handleClose.bind(this);\n    this.ws.onmessage = this.handleMessage.bind(this);\n    // ws.onerror is not handled because the event gives no data about the\n    // error, and on a connection failure onclose will be called.\n\n    this.connected = false;\n  }\n\n  cancelReconnect() {\n    if (this.reconnectTimeout !== null) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n  }\n\n  reconnect() {\n    this.cancelReconnect();\n    this.reconnectTimeout = setTimeout(() => {\n      this.reconnectTimeout = null;\n      this.connect();\n    }, RECONNECT_TIME);\n    this.events.emit('connectWait');\n    console.log(`Will attempt to reconnect in ${RECONNECT_TIME / 1000} seconds...`);\n  }\n\n  handleOpen() {\n    this.cancelReconnect();\n\n    this.connected = true;\n    console.log('Connected.');\n    this.events.emit('connect');\n    this.schedulePing();\n  }\n\n  handleClose(ev) {\n    this.connected = false;\n    this.cancelPing();\n    // ev.code is defined here https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n    // but according to people the only code one normally gets is 1006 (Abnormal Closure)\n    console.error(\n      `Disconnected with code ${ev.code}`,\n      ev.code === 1006 ? ': Abnormal closure' : '',\n      ev.reason ? `(reason: ${ev.reason})` : ''\n    );\n    this.events.emit('disconnect');\n    this.reconnect();\n  }\n\n  handleMessage(ev) {\n    const message = JSON.parse(ev.data);\n    if (message.type === 'map_update') {\n      this.events.emit('map_update', message.cells);\n    }\n    else if (message.type === 'vars_update') {\n      this.events.emit('vars_update', message.variables);\n    }\n    else if (message.type === 'goals_update') {\n      this.events.emit('goals_update', message.goals);\n    }\n    else if (message.type === 'pong') {\n      this.handlePong();\n    }\n  }\n\n  handlePong() {\n    this.cancelPongWait();\n  }\n\n  send(data) {\n    this.cancelPing();\n    const message = typeof data === 'string' ? { type: data } : data;\n    this.ws.send(JSON.stringify(message));\n    this.schedulePing();\n  }\n\n  cancelPing() {\n    if (this.pingTimeout !== null) {\n      clearTimeout(this.pingTimeout);\n      this.pingTimeout = null;\n    }\n  }\n\n  schedulePing() {\n    this.cancelPing();\n    this.pingTimeout = setTimeout(() => {\n      this.pingTimeout = null;\n      this.ping();\n    }, PING_TIME);\n  }\n\n  cancelPongWait() {\n    if (this.pongWaitTimeout !== null) {\n      clearTimeout(this.pongWaitTimeout);\n      this.pongWaitTimeout = null;\n    }\n  }\n\n  startPongWait() {\n    this.pongWaitTimeout = setTimeout(() => {\n      this.pongWaitTimeout = null;\n      console.warn(`PONG not received after ${PONG_WAIT_TIME / 1000} seconds`);\n      console.warn('Closing connection');\n      this.ws.close();\n    }, PONG_WAIT_TIME);\n  }\n\n  ping() {\n    this.send('ping');\n    this.startPongWait();\n  }\n\n  getMap() {\n    this.send('get_map');\n  }\n\n  setMap(cells) {\n    this.send({\n      type: 'set_map',\n      cells,\n    });\n  }\n\n  getVars() {\n    this.send('get_vars');\n  }\n\n  getGoals() {\n    this.send('get_goals');\n  }\n}\n\nmodule.exports = ServerSocketConnector;\n","/* globals PIXI */\nconst Array2D = require('./aux/array-2d');\n\nconst TILE_SIZE = 10;\n\nclass VariableMapView {\n  constructor(width, height, color) {\n    this.displayObject = new PIXI.Container();\n    this.color = color;\n    this.tiles = Array2D.create(width, height, null);\n    this.values = Array2D.create(width, height, 0);\n\n    Array2D.fill(this.tiles, (x, y) => {\n      const newTile = new PIXI.Graphics();\n      newTile.x = x * TILE_SIZE;\n      newTile.y = y * TILE_SIZE;\n      return newTile;\n    });\n\n    this.displayObject.addChild(...Array2D.flatten(this.tiles));\n    Array2D.forEach(this.values, (value, x, y) => {\n      this.renderTile(x, y);\n    });\n  }\n\n  renderTile(x, y) {\n    this.tiles[y][x]\n      .clear()\n      .beginFill(this.color, this.values[y][x])\n      .drawRect(0, 0, TILE_SIZE, TILE_SIZE)\n      .endFill();\n  }\n\n  update(data) {\n    Array2D.zip(this.values, data, (value, newValue, x, y) => {\n      if (value !== newValue) {\n        this.values[y][x] = newValue;\n        this.renderTile(x, y);\n      }\n    });\n  }\n}\n\nmodule.exports = VariableMapView;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","/* globals PIXI */\nconst City = require('./city');\nconst MapEditor = require('./editor/map-editor');\nconst VariableMapView = require('./variable-map-view');\nrequire('../sass/default.scss');\nconst ServerSocketConnector = require('./server-socket-connector');\nconst ConnectionStateView = require('./connection-state-view');\nconst showFatalError = require('./aux/show-fatal-error');\nconst PollutionData = require('./data-sources/pollution-data');\nconst NoiseData = require('./data-sources/noise-data');\nconst DataManager = require('./data-manager');\n\nfetch(`${process.env.SERVER_HTTP_URI}/config`, { cache: 'no-store' })\n  .then(response => response.json())\n  .then((config) => {\n    // const city = City.fromJSON(Cities.cities[0]);\n    const city = new City(config.cityWidth, config.cityHeight);\n\n    const stats = new DataManager();\n    stats.registerSource(new PollutionData(city, config));\n    stats.registerSource(new NoiseData(city, config));\n    city.map.events.on('update', () => {\n      stats.calculateAll();\n    });\n\n    const app = new PIXI.Application({\n      width: 3840,\n      height: 1920,\n      backgroundColor: 0xf2f2f2,\n    });\n    // Add a pre-load middleware that does cache-busting\n    app.loader.pre((resource, next) => { resource.url += `?t=${Date.now()}`; next(); });\n    app.loader.add('./textures/road-textures.json');\n    app.loader.load((loader, resources) => {\n      $('[data-component=\"app-container\"]').append(app.view);\n      const textures = Object.assign(\n        {},\n        resources['./textures/road-textures.json'].textures,\n      );\n\n      // Change the scaling mode for the road textures\n      Object.keys(textures).forEach((id) => {\n        textures[id].baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;\n      });\n\n      // const mapView = new MapView(city, config, textures);\n      const mapView = new MapEditor($('body'), city, config, textures);\n      app.stage.addChild(mapView.displayObject);\n      mapView.displayObject.width = 1920;\n      mapView.displayObject.height = 1920;\n      mapView.displayObject.x = 0;\n      mapView.displayObject.y = 0;\n\n      const emissionsVarViewer = new VariableMapView(city.map.width, city.map.height, 0x953202);\n      app.stage.addChild(emissionsVarViewer.displayObject);\n      emissionsVarViewer.displayObject.width = 960;\n      emissionsVarViewer.displayObject.height = 960;\n      emissionsVarViewer.displayObject.x = 1920 + 40;\n      emissionsVarViewer.displayObject.y = 0;\n\n      const noiseVarViewer = new VariableMapView(city.map.width, city.map.height, 0x20e95ff);\n      app.stage.addChild(noiseVarViewer.displayObject);\n      noiseVarViewer.displayObject.width = 960;\n      noiseVarViewer.displayObject.height = 960;\n      noiseVarViewer.displayObject.x = 1920 + 40;\n      noiseVarViewer.displayObject.y = 960;\n\n      city.map.events.on('update', () => {\n        emissionsVarViewer.update(stats.get('pollution-map'));\n        noiseVarViewer.update(stats.get('noise-map'));\n      });\n\n      const connector = new ServerSocketConnector(process.env.SERVER_SOCKET_URI);\n      connector.events.once('map_update', (cells) => {\n        city.map.replace(cells);\n        city.map.events.on('update', () => {\n          connector.setMap(city.map.cells);\n        });\n      });\n      connector.events.on('connect', () => {\n        connector.getMap();\n      });\n      const connStateView = new ConnectionStateView(connector);\n      $('body').append(connStateView.$element);\n    });\n  })\n  .catch((err) => {\n    showFatalError(`Error loading configuration from ${process.env.SERVER_HTTP_URI}`, err);\n    console.error(`Error loading configuration from ${process.env.SERVER_HTTP_URI}`);\n    console.error(err);\n  });\n"],"sourceRoot":""}